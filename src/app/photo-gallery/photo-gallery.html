<div id="gallery-limitation">
  <div class="gallery-filter">
    <button *ngIf="currentPath.length" (click)="goUpOneLevel()">Zurück</button>
    <button
      *ngFor="let folder of currentLevelFolders"
      (click)="goToSubfolder(folder)"
      [class.active]="selectedFolder === getCurrentFolderPath(folder)"
    >
      {{ formatFolderLabel(folder) }}
    </button>
    <button (click)="clearAllFilters()" [class.active]="!selectedFolder && !currentPath.length">Alle</button>
  </div>

  <div class="gallery-container">
    <div class="gallery-loader" *ngIf="isLoading">
      <img src="assets/img/logos/christian-boehme-logo-512px.png" alt="Lädt…" class="loader-logo" />
    </div>

    <div class="gallery-grid" [class.loading]="isLoading">
      <div
        class="gallery-item"
        *ngFor="let img of pagedImages; let i = index; trackBy: trackBySrc"
        (click)="openLightbox((page - 1) * PAGE_SIZE + i)"
        style="cursor:pointer"
      >
        <div class="img-wrapper">
          <img
            [src]="img.src"
            [alt]="img.description"
            [attr.loading]="i < FIRST_BATCH_COUNT ? 'eager' : 'lazy'"
            (load)="onImageLoad(img.src)"
            (error)="onImageLoad(img.src)"
          />
          <div class="img-description">{{ img.description }}</div>
        </div>
      </div>
    </div>

    <div class="gallery-pagination" *ngIf="totalPages > 1">
      <button
        *ngFor="let p of [].constructor(totalPages); let i = index"
        (click)="goToPage(i + 1)"
        [class.active]="page === i + 1"
      >
        {{ i + 1 }}
      </button>
    </div>
  </div>

  <!-- Lightbox -->
  <div
    class="lightbox"
    *ngIf="lightboxImage"
    (click)="closeLightbox()"
    tabindex="0"
    (keydown.arrowLeft)="prevImage()"
    (keydown.arrowRight)="nextImage()"
  >
    <div class="lightbox-content" (click)="$event.stopPropagation()">
      <button class="lightbox-nav left" (click)="prevImage()" [disabled]="selectedImageIndex === 0">&#8592;</button>
      <img [src]="lightboxImage.src" [alt]="lightboxImage.description" />
      <button class="lightbox-nav right" (click)="nextImage()" [disabled]="selectedImageIndex === filteredImages.length - 1">&#8594;</button>
      <div class="lightbox-desc">{{ lightboxImage.description }}</div>
      <button class="lightbox-close" (click)="closeLightbox()">×</button>
    </div>
  </div>
</div>